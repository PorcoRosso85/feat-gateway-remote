#!/usr/bin/env bash
# gw-ssh: Direct SSH connection (ProxyJump prohibited)
# Connects to remote via SSH. remote side uses zmx attach via RemoteCommand.

if ! command -v ssh >/dev/null 2>&1; then
  echo "contracted command: gw-ssh (openssh not available)"
  exit 1
fi

usage() {
  echo "contracted command: gw-ssh"
  echo "Usage: gw-ssh [user@]host [command]"
  echo ""
  echo "Options:"
  echo "  --help     Show this help"
  echo ""
  echo "Note: Direct connection only. Jump methods are prohibited."
}

HOST=""
CMD=""
SHOW_HELP=false

for arg in "$@"; do
  case "$arg" in
    --help)
      SHOW_HELP=true
      ;;
    -*)
      echo "Unknown option: $arg"
      exit 1
      ;;
    *)
      if [ -z "$HOST" ]; then
        HOST="$arg"
      else
        CMD="$arg"
      fi
      ;;
  esac
done

if [ "$SHOW_HELP" = true ] || [ -z "$HOST" ]; then
  usage
  exit 0
fi

echo "Connecting to: $HOST"
if [ -n "$CMD" ]; then
  echo "Running command: $CMD"
  exec ssh -o ProxyJump=none -o JumpHost=none "$HOST" "$CMD"
else
  exec ssh -o ProxyJump=none -o JumpHost=none "$HOST"
fi
