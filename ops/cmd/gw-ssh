#!/usr/bin/env bash
# gw-ssh: Direct SSH connection (ProxyJump prohibited)
# Connects to remote via SSH. remote side uses zmx attach via RemoteCommand.

if ! command -v ssh >/dev/null 2>&1; then
  echo "contracted command: gw-ssh (openssh not available)"
  exit 1
fi

usage() {
  echo "contracted command: gw-ssh"
  echo "Usage: gw-ssh [user@]host [command]"
  echo ""
  echo "Options:"
  echo "  --help     Show this help"
  echo ""
  echo "Note: Indirect connection methods (ProxyJump/-J) are prohibited."
  exit 0
}

HOST=""
CMD=""

for arg in "$@"; do
  case "$arg" in
    --help)
      usage
      ;;
    -*)
      echo "Unknown option: $arg"
      exit 1
      ;;
    *)
      if [ -z "$HOST" ]; then
        HOST="$arg"
      else
        CMD="$arg"
      fi
      ;;
  esac
done

if [ -z "$HOST" ]; then
  echo "Error: host required"
  echo "Usage: gw-ssh [user@]host [command]"
  exit 1
fi

echo "Connecting to: $HOST"
if [ -n "$CMD" ]; then
  echo "Running command: $CMD"
  exec ssh -o ProxyJump=none -o JumpHost=none "$HOST" "$CMD"
else
  exec ssh -o ProxyJump=none -o JumpHost=none "$HOST"
fi
