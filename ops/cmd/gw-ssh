#!/usr/bin/env bash
# gw-ssh: Direct SSH connection (ProxyJump/ProxyCommand prohibited)
# Connects to remote via SSH. remote side uses zmx attach via RemoteCommand.
# Note: This command only accepts host. Command arguments are not supported.

if ! command -v ssh >/dev/null 2>&1; then
  echo "contracted command: gw-ssh (openssh not available)"
  exit 1
fi

usage() {
  echo "contracted command: gw-ssh"
  echo "Usage: gw-ssh [user@]host"
  echo ""
  echo "Options:"
  echo "  --help     Show this help"
  echo ""
  echo "Note: Direct connection only. Jump/Proxy methods are prohibited."
}

HOST=""
SHOW_HELP=false

for arg in "$@"; do
  case "$arg" in
    --help)
      SHOW_HELP=true
      ;;
    -*)
      echo "Unknown option: $arg"
      exit 1
      ;;
    *)
      if [ -z "$HOST" ]; then
        HOST="$arg"
      else
        echo "Error: only one host argument supported"
        echo "Usage: gw-ssh [user@]host"
        exit 1
      fi
      ;;
  esac
done

if [ "$SHOW_HELP" = true ] || [ -z "$HOST" ]; then
  usage
  exit 0
fi

echo "Connecting to: $HOST"
exec ssh -o ProxyJump=none -o ProxyCommand=none -o RequestTTY=force "$HOST"
